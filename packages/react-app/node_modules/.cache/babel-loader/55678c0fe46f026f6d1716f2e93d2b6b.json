{"ast":null,"code":"import _regeneratorRuntime from\"/Users/daddio/Documents/Scaffold-Eth/SpeedRunEthereum/Challenge3/challenge-5-dex/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/daddio/Documents/Scaffold-Eth/SpeedRunEthereum/Challenge3/challenge-5-dex/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _objectSpread from\"/Users/daddio/Documents/Scaffold-Eth/SpeedRunEthereum/Challenge3/challenge-5-dex/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"/Users/daddio/Documents/Scaffold-Eth/SpeedRunEthereum/Challenge3/challenge-5-dex/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{Card,Col,Divider,Input,Row}from\"antd\";import{useBalance,useContractReader}from\"eth-hooks\";import{useTokenBalance}from\"eth-hooks/erc/erc-20/useTokenBalance\";import{ethers}from\"ethers\";import React,{useState}from\"react\";import Address from\"./Address\";import Contract from\"./Contract\";import Curve from\"./Curve.jsx\";import TokenBalance from\"./TokenBalance\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var contractName=\"DEX\";var tokenName=\"Balloons\";export default function Dex(props){var display=[];var _useState=useState({}),_useState2=_slicedToArray(_useState,2),form=_useState2[0],setForm=_useState2[1];var _useState3=useState({}),_useState4=_slicedToArray(_useState3,2),values=_useState4[0],setValues=_useState4[1];var tx=props.tx;var writeContracts=props.writeContracts;var contractAddress=props.readContracts[contractName].address;var tokenAddress=props.readContracts[tokenName].address;var contractBalance=useBalance(props.localProvider,contractAddress);var tokenBalance=useTokenBalance(props.readContracts[tokenName],contractAddress,props.localProvider);var tokenBalanceFloat=parseFloat(ethers.utils.formatEther(tokenBalance));var ethBalanceFloat=parseFloat(ethers.utils.formatEther(contractBalance));var liquidity=useContractReader(props.readContracts,contractName,\"liquidity\",[props.address]);var rowForm=function rowForm(title,icon,_onClick){return/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{span:8,style:{textAlign:\"right\",opacity:0.333,paddingRight:6,fontSize:24},children:title}),/*#__PURE__*/_jsx(Col,{span:16,children:/*#__PURE__*/_jsx(\"div\",{style:{cursor:\"pointer\",margin:2},children:/*#__PURE__*/_jsx(Input,{onChange:function onChange(e){var newValues=_objectSpread({},values);newValues[title]=e.target.value;setValues(newValues);},value:values[title],addonAfter:/*#__PURE__*/_jsx(\"div\",{type:\"default\",onClick:function onClick(){_onClick(values[title]);var newValues=_objectSpread({},values);newValues[title]=\"\";setValues(newValues);},children:icon})})})})]});};if(props.readContracts&&props.readContracts[contractName]){display.push(/*#__PURE__*/_jsxs(\"div\",{children:[rowForm(\"ethToToken\",\"üí∏\",/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(value){var valueInEther,swapEthToTokenResult;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:valueInEther=ethers.utils.parseEther(\"\"+value);_context.next=3;return tx(writeContracts[contractName][\"ethToToken\"]({value:valueInEther}));case 3:swapEthToTokenResult=_context.sent;console.log(\"swapEthToTokenResult:\",swapEthToTokenResult);case 5:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}()),rowForm(\"tokenToEth\",\"üîè\",/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(value){var valueInEther,allowance,approveTx,swapTx,approveTxResult,swapTxResult;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:valueInEther=ethers.utils.parseEther(\"\"+value);console.log(\"valueInEther\",valueInEther);_context2.next=4;return props.readContracts[tokenName].allowance(props.address,props.readContracts[contractName].address);case 4:allowance=_context2.sent;console.log(\"allowance\",allowance);if(!allowance.lt(valueInEther)){_context2.next=10;break;}_context2.next=9;return tx(writeContracts[tokenName].approve(props.readContracts[contractName].address,valueInEther,{gasLimit:200000}));case 9:approveTx=_context2.sent;case 10:swapTx=tx(writeContracts[contractName][\"tokenToEth\"](valueInEther,{gasLimit:200000}));if(!approveTx){_context2.next=17;break;}console.log(\"waiting on approve to finish...\");_context2.next=15;return approveTx;case 15:approveTxResult=_context2.sent;console.log(\"approveTxResult:\",approveTxResult);case 17:_context2.next=19;return swapTx;case 19:swapTxResult=_context2.sent;console.log(\"swapTxResult:\",swapTxResult);case 21:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x2){return _ref2.apply(this,arguments);};}()),/*#__PURE__*/_jsxs(Divider,{children:[\" Liquidity (\",liquidity?ethers.utils.formatEther(liquidity):\"none\",\"):\"]}),rowForm(\"deposit\",\"üì•\",/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(value){var valueInEther,expectedTokenAmount,allowance;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:valueInEther=ethers.utils.parseEther(\"\"+value);expectedTokenAmount=valueInEther.mul(tokenBalance).div(contractBalance).add(1);console.log(\"expectedTokenAmount\",expectedTokenAmount);_context3.next=5;return props.readContracts[tokenName].allowance(props.address,props.readContracts[contractName].address);case 5:allowance=_context3.sent;console.log(\"allowance\",allowance);if(!allowance.lt(expectedTokenAmount)){_context3.next=10;break;}_context3.next=10;return tx(writeContracts[tokenName].approve(props.readContracts[contractName].address,expectedTokenAmount,{gasLimit:200000}));case 10:_context3.next=12;return tx(writeContracts[contractName][\"deposit\"]({value:valueInEther,gasLimit:200000}));case 12:case\"end\":return _context3.stop();}}},_callee3);}));return function(_x3){return _ref3.apply(this,arguments);};}()),rowForm(\"withdraw\",\"üì§\",/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(value){var valueInEther,withdrawTxResult;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:valueInEther=ethers.utils.parseEther(\"\"+value);_context4.next=3;return tx(writeContracts[contractName][\"withdraw\"](valueInEther));case 3:withdrawTxResult=_context4.sent;console.log(\"withdrawTxResult:\",withdrawTxResult);case 5:case\"end\":return _context4.stop();}}},_callee4);}));return function(_x4){return _ref4.apply(this,arguments);};}())]}));}return/*#__PURE__*/_jsxs(Row,{span:24,children:[/*#__PURE__*/_jsxs(Col,{span:12,children:[/*#__PURE__*/_jsx(Card,{title:/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Address,{value:contractAddress}),/*#__PURE__*/_jsxs(\"div\",{style:{float:\"right\",fontSize:24},children:[parseFloat(ethers.utils.formatEther(contractBalance)).toFixed(4),\" \\u2696\\uFE0F\",/*#__PURE__*/_jsx(TokenBalance,{name:tokenName,img:\"üéà\",address:contractAddress,contracts:props.readContracts})]})]}),size:\"large\",loading:false,children:display}),/*#__PURE__*/_jsx(Row,{span:12,children:/*#__PURE__*/_jsx(Contract,{name:\"Balloons\",signer:props.signer,provider:props.localProvider,show:[\"balanceOf\",\"approve\"],address:props.address,blockExplorer:props.blockExplorer,contractConfig:props.contractConfig})})]}),/*#__PURE__*/_jsx(Col,{span:12,children:/*#__PURE__*/_jsx(\"div\",{style:{padding:20},children:/*#__PURE__*/_jsx(Curve,{addingEth:values&&values[\"ethToToken\"]?values[\"ethToToken\"]:0,addingToken:values&&values[\"tokenToEth\"]?values[\"tokenToEth\"]:0,ethReserve:ethBalanceFloat,tokenReserve:tokenBalanceFloat,width:500,height:500})})})]});}","map":{"version":3,"sources":["/Users/daddio/Documents/Scaffold-Eth/SpeedRunEthereum/Challenge3/challenge-5-dex/packages/react-app/src/components/DEX.jsx"],"names":["Card","Col","Divider","Input","Row","useBalance","useContractReader","useTokenBalance","ethers","React","useState","Address","Contract","Curve","TokenBalance","contractName","tokenName","Dex","props","display","form","setForm","values","setValues","tx","writeContracts","contractAddress","readContracts","address","tokenAddress","contractBalance","localProvider","tokenBalance","tokenBalanceFloat","parseFloat","utils","formatEther","ethBalanceFloat","liquidity","rowForm","title","icon","onClick","textAlign","opacity","paddingRight","fontSize","cursor","margin","e","newValues","target","value","push","valueInEther","parseEther","swapEthToTokenResult","console","log","allowance","lt","approve","gasLimit","approveTx","swapTx","approveTxResult","swapTxResult","expectedTokenAmount","mul","div","add","withdrawTxResult","float","toFixed","signer","blockExplorer","contractConfig","padding"],"mappings":"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","sourcesContent":["import { Card, Col, Divider, Input, Row } from \"antd\";\nimport { useBalance, useContractReader } from \"eth-hooks\";\nimport { useTokenBalance } from \"eth-hooks/erc/erc-20/useTokenBalance\";\nimport { ethers } from \"ethers\";\nimport React, { useState } from \"react\";\nimport Address from \"./Address\";\nimport Contract from \"./Contract\";\nimport Curve from \"./Curve.jsx\";\nimport TokenBalance from \"./TokenBalance\";\n\nconst contractName = \"DEX\";\nconst tokenName = \"Balloons\";\n\nexport default function Dex(props) {\n  let display = [];\n\n  const [form, setForm] = useState({});\n  const [values, setValues] = useState({});\n  const tx = props.tx;\n\n  const writeContracts = props.writeContracts;\n\n  const contractAddress = props.readContracts[contractName].address;\n  const tokenAddress = props.readContracts[tokenName].address;\n  const contractBalance = useBalance(props.localProvider, contractAddress);\n\n  const tokenBalance = useTokenBalance(props.readContracts[tokenName], contractAddress, props.localProvider);\n  const tokenBalanceFloat = parseFloat(ethers.utils.formatEther(tokenBalance));\n  const ethBalanceFloat = parseFloat(ethers.utils.formatEther(contractBalance));\n  const liquidity = useContractReader(props.readContracts, contractName, \"liquidity\", [props.address]);\n\n  const rowForm = (title, icon, onClick) => {\n    return (\n      <Row>\n        <Col span={8} style={{ textAlign: \"right\", opacity: 0.333, paddingRight: 6, fontSize: 24 }}>\n          {title}\n        </Col>\n        <Col span={16}>\n          <div style={{ cursor: \"pointer\", margin: 2 }}>\n            <Input\n              onChange={e => {\n                let newValues = { ...values };\n                newValues[title] = e.target.value;\n                setValues(newValues);\n              }}\n              value={values[title]}\n              addonAfter={\n                <div\n                  type=\"default\"\n                  onClick={() => {\n                    onClick(values[title]);\n                    let newValues = { ...values };\n                    newValues[title] = \"\";\n                    setValues(newValues);\n                  }}\n                >\n                  {icon}\n                </div>\n              }\n            />\n          </div>\n        </Col>\n      </Row>\n    );\n  };\n\n  if (props.readContracts && props.readContracts[contractName]) {\n    display.push(\n      <div>\n        {rowForm(\"ethToToken\", \"üí∏\", async value => {\n          let valueInEther = ethers.utils.parseEther(\"\" + value);\n          let swapEthToTokenResult = await tx(writeContracts[contractName][\"ethToToken\"]({ value: valueInEther }));\n          console.log(\"swapEthToTokenResult:\", swapEthToTokenResult);\n        })}\n\n        {rowForm(\"tokenToEth\", \"üîè\", async value => {\n          let valueInEther = ethers.utils.parseEther(\"\" + value);\n          console.log(\"valueInEther\", valueInEther);\n          let allowance = await props.readContracts[tokenName].allowance(\n            props.address,\n            props.readContracts[contractName].address,\n          );\n          console.log(\"allowance\", allowance);\n\n          let approveTx;\n          if (allowance.lt(valueInEther)) {\n            approveTx = await tx(\n              writeContracts[tokenName].approve(props.readContracts[contractName].address, valueInEther, {\n                gasLimit: 200000,\n              }),\n            );\n          }\n\n          let swapTx = tx(writeContracts[contractName][\"tokenToEth\"](valueInEther, { gasLimit: 200000 }));\n          if (approveTx) {\n            console.log(\"waiting on approve to finish...\");\n            let approveTxResult = await approveTx;\n            console.log(\"approveTxResult:\", approveTxResult);\n          }\n          let swapTxResult = await swapTx;\n          console.log(\"swapTxResult:\", swapTxResult);\n        })}\n\n        <Divider> Liquidity ({liquidity ? ethers.utils.formatEther(liquidity) : \"none\"}):</Divider>\n\n        {rowForm(\"deposit\", \"üì•\", async value => {\n          let valueInEther = ethers.utils.parseEther(\"\" + value);\n\n          let expectedTokenAmount = valueInEther.mul(tokenBalance).div(contractBalance).add(1);\n          console.log(\"expectedTokenAmount\", expectedTokenAmount);\n          let allowance = await props.readContracts[tokenName].allowance(\n            props.address,\n            props.readContracts[contractName].address,\n          );\n          console.log(\"allowance\", allowance);\n          if (allowance.lt(expectedTokenAmount)) {\n            await tx(\n              writeContracts[tokenName].approve(props.readContracts[contractName].address, expectedTokenAmount, {\n                gasLimit: 200000,\n              }),\n            );\n          }\n          await tx(writeContracts[contractName][\"deposit\"]({ value: valueInEther, gasLimit: 200000 }));\n        })}\n\n        {rowForm(\"withdraw\", \"üì§\", async value => {\n          let valueInEther = ethers.utils.parseEther(\"\" + value);\n          let withdrawTxResult = await tx(writeContracts[contractName][\"withdraw\"](valueInEther));\n          console.log(\"withdrawTxResult:\", withdrawTxResult);\n        })}\n      </div>,\n    );\n  }\n\n  return (\n    <Row span={24}>\n      <Col span={12}>\n        <Card\n          title={\n            <div>\n              <Address value={contractAddress} />\n              <div style={{ float: \"right\", fontSize: 24 }}>\n                {parseFloat(ethers.utils.formatEther(contractBalance)).toFixed(4)} ‚öñÔ∏è\n                <TokenBalance name={tokenName} img={\"üéà\"} address={contractAddress} contracts={props.readContracts} />\n              </div>\n            </div>\n          }\n          size=\"large\"\n          loading={false}\n        >\n          {display}\n        </Card>\n        <Row span={12}>\n          <Contract\n            name=\"Balloons\"\n            signer={props.signer}\n            provider={props.localProvider}\n            show={[\"balanceOf\", \"approve\"]}\n            address={props.address}\n            blockExplorer={props.blockExplorer}\n            contractConfig={props.contractConfig}\n          />\n        </Row>\n      </Col>\n      <Col span={12}>\n        <div style={{ padding: 20 }}>\n          <Curve\n            addingEth={values && values[\"ethToToken\"] ? values[\"ethToToken\"] : 0}\n            addingToken={values && values[\"tokenToEth\"] ? values[\"tokenToEth\"] : 0}\n            ethReserve={ethBalanceFloat}\n            tokenReserve={tokenBalanceFloat}\n            width={500}\n            height={500}\n          />\n        </div>\n      </Col>\n    </Row>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}